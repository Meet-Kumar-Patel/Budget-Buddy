import json

import boto3

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('UserExpense') 

def lambda_handler(event, context):
    username = event['username']
    updates = event.get('updates', {}) 

    try:
        # Fetching the existing item
        response = table.get_item(
            Key={
                'username': username,
            }
        )
        
        if 'Item' in response:
            # Updating the values
            update_expression = "SET " + ", ".join(f"{key} = :new_{key}" for key in updates)
            expression_attribute_values = {f":new_{key}": value for key, value in updates.items()}

            table.update_item(
                Key={
                    'username': username,
                },
                UpdateExpression=update_expression,
                ExpressionAttributeValues=expression_attribute_values,
                ReturnValues="UPDATED_NEW"
            )

            return {
                'statusCode': 200,
                'body': json.dumps({'message': 'User data updated successfully'})
            }
        else:
            return {
                'statusCode': 404,
                'body': json.dumps({'message': 'User not found'})
            }

    except Exception as e:
        print(e)
        
        return {
            'statusCode': 500,
            'body': json.dumps({'message': 'Failed to update user data'})
        }